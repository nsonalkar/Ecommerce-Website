import os
import shutil
from subprocess import call
from cfe.styling import progress

def initialize_project(src_path, project_, creating=True, prefix = 'Creating:', suffix = 'Complete'):
    if not creating:
        prefix = 'Replacing'
        progress(15, 100, prefix='Replacing:', suffix=suffix)
        shutil.rmtree(src_path)
    progress(35, 100, prefix=prefix, suffix=suffix)
    os.mkdir(src_path)
    progress(50, 100, prefix=prefix, suffix=suffix)
    #call(["django-admin.py", "startproject", str(project_), src_path])
    make_project(project_, src_path)
    prefix = 'Created   '
    if not creating:
        prefix = 'Replaced  '
    suffix = 'Done        '
    progress(100, 100, prefix=prefix, suffix=suffix)


def make_project(project, src_path):
    src_path = os.path.abspath(src_path)
    if project == 'blank':
        current_dir = os.getcwd()
        call(['git', 'clone', 'https://github.com/codingforentrepreneurs/CFE-Blank-Project', src_path])
        git_path = os.path.join(src_path, '.git')
        shutil.rmtree(git_path)
        requirements_txt = os.path.join(src_path, 'src', 'requirements.txt')
        call(['pip', 'install', '-r', requirements_txt])


# if new_: #ignore replace
#     if check_path:
#         parser.error(message="A project already exists. Please use the replace flag (-r, --replace) or get help (-h).")
#     else:
#         progress(10, 100, prefix='Creating:', suffix='Complete')
#         #call(["mkdir", "src"])
#         os.mkdir(src_path)
#         progress(50, 100, prefix='Creating:', suffix='Complete')
#         call(["django-admin.py", "startproject", str(project_), "./src"])
#         progress(100, 100, prefix='Created:', suffix='Complete')
# elif not new_ and replace_:
#     if not check_path:
#         #parser.error(message='The "./src/" directory does not exist, creating')
#         print('\nThe "./src/" directory does not exist\n')
#         progress(10, 100, prefix='Creating:', suffix='Complete')
#         #call(["mkdir", "src"])
#         progress(15, 100, prefix='Creating:', suffix='Complete')
#         os.mkdir(src_path)
#         progress(50, 100, prefix='Creating:', suffix='Complete')
#         call(["django-admin.py", "startproject", str(project_), "./src"])
#         progress(100, 100, prefix='Creating:', suffix='Complete')

#     else:
#         print("\n*********\nAre you sure you want to replace your current project?\nIt's the one in:\n\n" + src_path + "\n\n*********\n\nThis CANNOT be undone.\n\n(y/yes) Yes I'm sure.\n(n) Any other key to cancel.\n\n(Type your selection then press enter)")
#         answer_ = input()
#         if answer_.lower()  == 'y' or answer_.lower() == 'yes':
#             print('yes')
#             progress(15, 100, prefix='Replacing:', suffix='Complete')
#             shutil.rmtree(src_path) # remove src path
#             os.mkdir(src_path) # add src path
#             progress(50, 100, prefix='Replacing:', suffix='Complete')
#             call(["django-admin.py", "startproject", str(project_), "./src"])
#             progress(100, 100, prefix='Replacing:', suffix='Complete')
# else:
#     pass